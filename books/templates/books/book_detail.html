{% extends "base.html" %}

{% load static %}

{% block title %}{{ book.title }}{% if book.subtitle %}: {{ book.subtitle }}{% endif %}{% endblock %}

{% block header_search %}
  {% include "partials/search_form.html" %}
{% endblock %}

{% block content %}

  <div class="row g-4">
    <div class="col-md-3 d-flex flex-column justify-content-start align-items-center">
      {% if book.thumbnail %}
          <img 
          src="{{ book.thumbnail }}" 
          alt="{{ book.title }} cover" 
          class="img-fluid rounded border mb-3"
          >
      {% else %}
          <img
          src="{% static 'images/placeholder_cover.png' %}"
          alt="Placeholder cover"
          class="img-fluid mb-3"
          loading="lazy"
          decoding="async"
          width="320"
          height="480"
          >
      {% endif %}

      {% if request.user.is_authenticated %}
        <form action="{% url 'set_reading_status' book.id %}" method="post" class="w-100">
          {% csrf_token %}
          <select name="status" class="form-select mb-2">
            <option value="TO_READ">To read</option>
            <option value="READING">Reading</option>
            <option value="READ">Read</option>
          </select>
          <button class="btn btn-primary" type="submit">Save</button>
        </form>
      {% else %}
        <a href="{{ login_url }}?next={{ request.path }}" class="btn btn-outline-primary">
          Log in to save
        </a>
      {% endif %}
    </div>

    <div class="col-md-9">
      <h1 class="h3 mb-1">{{ book.title }}</h1>
      {% if book.subtitle %}<p class="text-muted mb-2">{{ book.subtitle }}</p>{% endif %}
      {% if book.authors %}
        <p class="mb-1"><strong>Author{% if book.authors|length > 1 %}s{% endif %}:</strong> {{ book.authors }}</p>
      {% endif %}
      <p class="mb-1">
        {% if book.publisher %}<strong>Publisher:</strong> {{ book.publisher }} Â· {% endif %}
        {% if book.publishedDate %}<strong>Published:</strong> {{ book.publishedDate }}{% endif %}
      </p>
      {% if book.pageCount %}<p class="mb-1"><strong>Pages:</strong> {{ book.pageCount }}</p>{% endif %}
      {% if book.categories %}<p class="mb-3"><strong>Categories:</strong> {{ book.categories|join:", " }}</p>{% endif %}

      {% if book.description %}
        <h2 class="h5 mt-4">Description</h2>
        <p>{{ book.description|safe }}</p>
      {% endif %}
    </div>
  </div>
{% endblock %}
