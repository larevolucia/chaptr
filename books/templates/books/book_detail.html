{% extends "base.html" %}

{% load static %}
{% load seo_extras %}

{% block title %}{{ book.title }}{% if book.subtitle %}: {{ book.subtitle }}{% endif %}{% endblock %}
{% block description %}{{ book|meta_desc:155|striptags|escape }}{% endblock %}
{% block keywords %}{{ book.categories|join:", "|striptags|escape }}{% endblock %}

{% block header_search %}
  {% include "books/partials/search_form.html" %}
{% endblock %}

{% block extra_js %}
    <script src="{% static 'js/rating.js' %}" defer></script>
    <script src="{% static 'js/delete_modal.js' %}" defer></script>
{% endblock %}

{% block content %}
  <!-- Book Details -->
  <div class="row g-4">
    <div class="col-md-3 d-flex flex-column justify-content-start align-items-center">
      <img 
            src="{{ book.cover_url }}"
            alt="{{ book.title }} cover" 
            class="img-fluid rounded border mb-3"
          loading="eager"
          >
      {% include "activity/partials/reading_status_button.html" %}
      <div id="rating" class="rating-widget d-flex flex-column align-items-center gap-2 mt-2">
        {% include "activity/partials/rating_button.html" %}
      </div>
    </div>

    <div class="col-md-9">
      <h1 class="h3 mb-1 book-title">{{ book.title }}</h1>
      {% include "activity/partials/book_rating_info.html" %}
      {% if book.subtitle %}<p class="text-muted mb-2">{{ book.subtitle }}</p>{% endif %}
      {% if book.authors %}
        <p class="mb-1"><strong>Author{% if book.authors|length > 1 %}s{% endif %}:</strong> {{ book.authors }}</p>
      {% endif %}
      <p class="mb-1">
        {% if book.publisher %}<strong>Publisher:</strong> {{ book.publisher }} Â· {% endif %}
        {% if book.publishedDate %}<strong>Published:</strong> {{ book.publishedDate }}{% endif %}
      </p>
      {% if book.pageCount %}<p class="mb-1"><strong>Pages:</strong> {{ book.pageCount }}</p>{% endif %}
      {% if book.categories %}<p class="mb-3"><strong>Categories:</strong> {{ book.categories|join:", " }}</p>{% endif %}

      {% if book.description %}
        <h2 class="h5 mt-4 book-description">Description</h2>
        <div class="book-description-content">
          {{ book.description|safe }}
        </div>
      {% endif %}
    </div>
  </div>
  <div id="reviews">
    {% include "activity/partials/reviews.html" %}
  </div>
{% endblock %}
